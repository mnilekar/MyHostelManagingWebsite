-- Run using HOSTEL_APP user on Oracle XE

CREATE TABLE APP_USER (
    ID NUMBER PRIMARY KEY,
    ROLE VARCHAR2(20) NOT NULL,
    FIRST_NAME VARCHAR2(50) NOT NULL,
    MIDDLE_NAME VARCHAR2(50),
    SURNAME VARCHAR2(50),
    GENDER VARCHAR2(20),
    EMAIL VARCHAR2(120) NOT NULL,
    NATIONALITY VARCHAR2(50) NOT NULL,
    COUNTRY_CODE VARCHAR2(10) NOT NULL,
    MOBILE_NUMBER VARCHAR2(20) NOT NULL,
    STATE_NAME VARCHAR2(50) NOT NULL,
    CITY_NAME VARCHAR2(50) NOT NULL,
    ID_PROOF_TYPE VARCHAR2(20) NOT NULL,
    ID_PROOF_VALUE VARCHAR2(50) NOT NULL,
    USERNAME VARCHAR2(30) NOT NULL,
    PASSWORD_HASH VARCHAR2(255) NOT NULL,
    CREATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT CK_APP_USER_ROLE CHECK (ROLE IN ('USER', 'EMPLOYEE', 'OWNER')),
    CONSTRAINT CK_APP_USER_GENDER CHECK (GENDER IN ('MALE', 'FEMALE', 'NOT_PREFERRED')),
    CONSTRAINT CK_APP_USER_ID_PROOF CHECK (ID_PROOF_TYPE IN ('AADHAR_CARD', 'VOTER_ID', 'PASSPORT')),
    CONSTRAINT UQ_APP_USER_USERNAME UNIQUE (USERNAME),
    CONSTRAINT UQ_APP_USER_EMAIL UNIQUE (EMAIL)
);

CREATE TABLE USER_PROFILE (
    USER_ID NUMBER PRIMARY KEY,
    HOME_ADDRESS VARCHAR2(60),
    CONSTRAINT FK_USER_PROFILE_USER FOREIGN KEY (USER_ID) REFERENCES APP_USER(ID)
);

CREATE TABLE EMPLOYEE_PROFILE (
    USER_ID NUMBER PRIMARY KEY,
    PERMANENT_ADDRESS VARCHAR2(60) NOT NULL,
    CURRENT_ADDRESS VARCHAR2(60) NOT NULL,
    SKILL VARCHAR2(30) NOT NULL,
    CONSTRAINT FK_EMPLOYEE_PROFILE_USER FOREIGN KEY (USER_ID) REFERENCES APP_USER(ID)
);

CREATE TABLE OWNER_PROFILE (
    USER_ID NUMBER PRIMARY KEY,
    PERMANENT_ADDRESS VARCHAR2(60) NOT NULL,
    CURRENT_ADDRESS VARCHAR2(60) NOT NULL,
    CONSTRAINT FK_OWNER_PROFILE_USER FOREIGN KEY (USER_ID) REFERENCES APP_USER(ID)
);

CREATE SEQUENCE APP_USER_SEQ START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;

-- Optional lookup placeholders for future DB-driven dropdowns
CREATE TABLE COUNTRY_MASTER (
    COUNTRY_NAME VARCHAR2(50) PRIMARY KEY,
    COUNTRY_CODE VARCHAR2(10) NOT NULL
);

CREATE TABLE STATE_MASTER (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    COUNTRY_NAME VARCHAR2(50) NOT NULL,
    STATE_NAME VARCHAR2(50) NOT NULL,
    CONSTRAINT FK_STATE_COUNTRY FOREIGN KEY (COUNTRY_NAME) REFERENCES COUNTRY_MASTER(COUNTRY_NAME)
);

CREATE TABLE CITY_MASTER (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    STATE_ID NUMBER NOT NULL,
    CITY_NAME VARCHAR2(50) NOT NULL,
    CONSTRAINT FK_CITY_STATE FOREIGN KEY (STATE_ID) REFERENCES STATE_MASTER(ID)
);

INSERT INTO COUNTRY_MASTER (COUNTRY_NAME, COUNTRY_CODE) VALUES ('India', '+91');
INSERT INTO STATE_MASTER (COUNTRY_NAME, STATE_NAME) VALUES ('India', 'Maharashtra');
INSERT INTO CITY_MASTER (STATE_ID, CITY_NAME)
SELECT ID, 'Pune' FROM STATE_MASTER WHERE STATE_NAME = 'Maharashtra' AND COUNTRY_NAME = 'India';

COMMIT;
